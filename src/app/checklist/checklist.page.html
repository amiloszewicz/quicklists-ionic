<ng-container *ngIf="vm$ | async as vm">
  <ion-header>
    <ion-toolbar>
      <ion-buttons slot="start">
        <ion-back-button defaultHref="/"></ion-back-button>
      </ion-buttons>
      <ion-title>{{ vm.checklist.title }}</ion-title>
      <ion-buttons slot="end">
        <ion-button (click)="resetChecklistItems(vm.checklist.id)">
          <ion-icon name="refresh" slot="icon-only"></ion-icon>
        </ion-button>
        <ion-button (click)="formModalIsOpen$.next(true)">
          <ion-icon name="add" slot="icon-only"></ion-icon>
        </ion-button>
      </ion-buttons>
    </ion-toolbar>
  </ion-header>

  <ion-content>
    <app-checklist-item-list
      [checklistItems]="vm.items"
      (toggle)="toggleChecklistItem($event)"
      (delete)="deleteChecklistItem($event)"
      (edit)="openEditModal($event)"
    ></app-checklist-item-list>
  </ion-content>

  <ion-content>
    <ion-modal
      [isOpen]="vm.formModalIsOpen"
      [canDismiss]="true"
      (ionModalDidDismiss)="formModalIsOpen$.next(false); checklistItemIsBeingEdited$.next(null)"
    >
      <ng-template>
        <app-form-modal
          [title]="vm.checklistItemIsBeingEdited ? 'Edit item' : 'Create item'"
          [formGroup]="checklistItemForm"
          (save)="vm.checklistItemIsBeingEdited ? editChecklistItem(vm.checklistItemIsBeingEdited) : addChecklistItem(vm.checklist.id)"
        >
        </app-form-modal>
      </ng-template>
    </ion-modal>
  </ion-content>
</ng-container>
